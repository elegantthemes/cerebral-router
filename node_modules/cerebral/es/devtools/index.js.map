{"version":3,"sources":["../../src/devtools/index.js"],"names":["delay","DevtoolsBase","PLACEHOLDER_INITIAL_MODEL","PLACEHOLDER_DEBUGGING_DATA","Devtools","storeMutations","preventExternalMutations","warnStateProps","preventPropsReplacement","bigComponentsWarning","host","https","reconnect","reconnectInterval","allowedTypes","version","debuggerComponentsMap","debuggerComponentDetailsId","mutations","initialModelString","controller","originalRunTreeFunction","isResettingDebugger","concat","File","FileList","Blob","ImageData","RegExp","sendInitial","bind","sendComponentsMap","ws","WebSocket","index","model","set","JSON","parse","run","name","console","warn","x","length","mutation","data","method","args","flush","emit","datetime","backlog","event","message","type","path","value","remember","reset","stringify","get","watchExecution","initialModel","source","replace","sendMessage","sendBulkMessage","isConnected","map","render","components","debuggingData","execution","functionDetails","payload","mutationString","executionId","id","functionIndex","push","component","_displayName","nextDeps","prevDeps","componentDetails","extractComponentName","renderCount","componentDetailsId","arguments","depsKey","debuggerComponents","splice","componentsToRender","changes","start","end","duration"],"mappings":";;;;;;;;;;;;AAAA;AACA,SAASA,KAAT,QAAsB,UAAtB;AACA,SAASC,YAAT,QAA6B,wBAA7B;AACA,IAAMC,4BAA4B,2BAAlC;AACA,IAAMC,6BAA6B,oBAAnC;;AAEA;;;;;AAKA,WAAaC,QAAb;AAAA;;AACE,sBAWQ;AAAA,mFAAJ,EAAI;AAAA,mCAVNC,cAUM;AAAA,QAVNA,cAUM,uCAVW,IAUX;AAAA,qCATNC,wBASM;AAAA,QATNA,wBASM,yCATqB,IASrB;AAAA,mCARNC,cAQM;AAAA,QARNA,cAQM,uCARW,IAQX;AAAA,qCAPNC,uBAOM;AAAA,QAPNA,uBAOM,yCAPoB,KAOpB;AAAA,qCANNC,oBAMM;AAAA,QANNA,oBAMM,yCANiB,EAMjB;AAAA,yBALNC,IAKM;AAAA,QALNA,IAKM,6BALC,IAKD;AAAA,0BAJNC,KAIM;AAAA,QAJNA,KAIM,8BAJE,KAIF;AAAA,8BAHNC,SAGM;AAAA,QAHNA,SAGM,kCAHM,IAGN;AAAA,qCAFNC,iBAEM;AAAA,QAFNA,iBAEM,yCAFc,IAEd;AAAA,iCADNC,YACM;AAAA,QADNA,YACM,qCADS,EACT;;AAAA;;AAAA,oHACA;AACJJ,gBADI;AAEJC,kBAFI;AAGJC,0BAHI;AAIJC;AAJI,KADA;;AAON,UAAKE,OAAL;AACA,UAAKC,qBAAL,GAA6B,EAA7B;AACA,UAAKC,0BAAL,GAAkC,CAAlC;AACA,UAAKZ,cAAL,GAAsBA,cAAtB;AACA,UAAKC,wBAAL,GAAgCA,wBAAhC;AACA,UAAKC,cAAL,GAAsBA,cAAtB;AACA,UAAKC,uBAAL,GAA+BA,uBAA/B;AACA,UAAKC,oBAAL,GAA4BA,oBAA5B;;AAEA,UAAKS,SAAL,GAAiB,EAAjB;AACA,UAAKC,kBAAL,GAA0B,IAA1B;AACA,UAAKC,UAAL,GAAkB,IAAlB;AACA,UAAKC,uBAAL,GAA+B,IAA/B;AACA,UAAKC,mBAAL,GAA2B,KAA3B;AACA,UAAKR,YAAL,GAAoB,GACjBS,MADiB,CACV,OAAOC,IAAP,KAAgB,WAAhB,GAA8B,EAA9B,GAAmCA,IADzB,EAEjBD,MAFiB,CAEV,OAAOE,QAAP,KAAoB,WAApB,GAAkC,EAAlC,GAAuCA,QAF7B,EAGjBF,MAHiB,CAGV,OAAOG,IAAP,KAAgB,WAAhB,GAA8B,EAA9B,GAAmCA,IAHzB,EAIjBH,MAJiB,CAIV,OAAOI,SAAP,KAAqB,WAArB,GAAmC,EAAnC,GAAwCA,SAJ9B,EAKjBJ,MALiB,CAKV,OAAOK,MAAP,KAAkB,WAAlB,GAAgC,EAAhC,GAAqCA,MAL3B,EAMjBL,MANiB,CAMVT,gBAAgB,EANN,CAApB;;AAQA,UAAKe,WAAL,GAAmB,MAAKA,WAAL,CAAiBC,IAAjB,OAAnB;AACA,UAAKC,iBAAL,GAAyB/B,MAAM,MAAK+B,iBAAX,EAA8B,EAA9B,CAAzB;AA9BM;AA+BP;;AA3CH;AAAA;AAAA,mCA4CiB;AACb,WAAKC,EAAL,GAAU,IAAIC,SAAJ,EAAiB,KAAKtB,KAAL,GAAa,KAAb,GAAqB,IAAtC,YAAgD,KAAKD,IAArD,CAAV;AACD;AACD;;;;;;;;;;;;AA/CF;AAAA;AAAA,6BA2DWwB,KA3DX,EA2DkB;AACd,WAAKd,UAAL,CAAgBe,KAAhB,CAAsBC,GAAtB,CAA0B,EAA1B,EAA8BC,KAAKC,KAAL,CAAW,KAAKnB,kBAAhB,CAA9B;;AAEA,UAAIe,UAAU,CAAd,EAAiB;AACf,aAAKd,UAAL,CAAgBmB,GAAhB,GAAsB,KAAKlB,uBAA3B;AACD,OAFD,MAEO;AACL,aAAKD,UAAL,CAAgBmB,GAAhB,GAAsB,UAACC,IAAD,EAAU;AAC9BC,kBAAQC,IAAR,kBACiBF,IADjB;AAGD,SAJD;AAKD;;AAED,WAAK,IAAIG,IAAI,CAAb,EAAgBA,IAAI,KAAKzB,SAAL,CAAe0B,MAAf,GAAwBV,KAA5C,EAAmDS,GAAnD,EAAwD;AAAA;;AACtD,YAAME,WAAWR,KAAKC,KAAL,CAAW,KAAKpB,SAAL,CAAeyB,CAAf,EAAkBG,IAA7B,CAAjB;AACA,kCAAK1B,UAAL,CAAgBe,KAAhB,EAAsBU,SAASE,MAA/B,8CAA0CF,SAASG,IAAnD;AACD;;AAED,WAAK5B,UAAL,CAAgB6B,KAAhB,CAAsB,IAAtB;AACA,WAAK7B,UAAL,CAAgB8B,IAAhB,CACE,UADF,EAEEb,KAAKC,KAAL,CAAW,KAAKpB,SAAL,CAAegB,KAAf,EAAsBY,IAAjC,EAAuCK,QAFzC;AAID;AACD;;;AAnFF;AAAA;AAAA,4BAsFU;AACN,WAAK/B,UAAL,CAAgBe,KAAhB,CAAsBC,GAAtB,CAA0B,EAA1B,EAA8BC,KAAKC,KAAL,CAAW,KAAKnB,kBAAhB,CAA9B;AACA,WAAKiC,OAAL,GAAe,EAAf;AACA,WAAKlC,SAAL,GAAiB,EAAjB;AACA,WAAKE,UAAL,CAAgB6B,KAAhB,CAAsB,IAAtB;AACD;AA3FH;AAAA;AAAA,8BA4FYI,KA5FZ,EA4FmB;AACf,UAAMC,UAAUjB,KAAKC,KAAL,CAAWe,MAAMP,IAAjB,CAAhB;AACA,cAAQQ,QAAQC,IAAhB;AACE,aAAK,aAAL;AACE,eAAKnC,UAAL,CAAgBe,KAAhB,CAAsBC,GAAtB,CAA0BkB,QAAQR,IAAR,CAAaU,IAAvC,EAA6CF,QAAQR,IAAR,CAAaW,KAA1D;AACA,eAAKrC,UAAL,CAAgB6B,KAAhB;AACA;AACF,aAAK,UAAL;AACE,cAAI,CAAC,KAAK5C,cAAV,EAA0B;AACxBoC,oBAAQC,IAAR,CACE,2FADF;AAGD,WAJD,MAIO;AACL,iBAAKgB,QAAL,CAAcJ,QAAQR,IAAtB;AACD;AACD;AACF,aAAK,OAAL;AACE,eAAKa,KAAL;AACA;AACF,aAAK,MAAL;AACE,eAAK9B,WAAL;AACA;AACF,aAAK,MAAL;AACE,eAAKA,WAAL;AACA;AAtBJ;AAwBD;AACD;;;;;;;;;;;;;AAvHF;AAAA;AAAA,yBAmIOT,UAnIP,EAmImB;AACf,WAAKA,UAAL,GAAkBA,cAAc,KAAKA,UAArC;AACA,WAAKC,uBAAL,GAA+B,KAAKD,UAAL,CAAgBmB,GAA/C;;AAEA,UAAI,KAAKlC,cAAT,EAAyB;AACvB,aAAKc,kBAAL,GAA0BkB,KAAKuB,SAAL,CAAe,KAAKxC,UAAL,CAAgBe,KAAhB,CAAsB0B,GAAtB,EAAf,CAA1B;AACD;;AAED;;AAEA,UAAIzC,UAAJ,EAAgB;AACd,aAAK0C,cAAL,CAAoB,KAAK1C,UAAzB,EAAqC,GAArC;AACD;AACF;AACD;;;;;AAjJF;AAAA;AAAA,kCAqJgB;AACZ,UAAM2C,eAAe,KAAK3C,UAAL,CAAgBe,KAAhB,CAAsB0B,GAAtB,EAArB;AACA,UAAMP,UAAUjB,KAAKuB,SAAL,CAAe;AAC7BL,cAAM,MADuB;AAE7BS,gBAAQ,GAFqB;AAG7BjD,iBAAS,KAAKA,OAHe;AAI7B+B,cAAM;AACJiB,wBAAc,KAAK5C,kBAAL,GACVjB,yBADU,GAEV6D;AAHA;AAJuB,OAAf,EASbE,OATa,OASD/D,yBATC,QAS6B,KAAKiB,kBATlC,CAAhB;;AAWA,WAAKG,mBAAL,GAA2B,IAA3B;AACA,WAAK4C,WAAL,CAAiBZ,OAAjB;AACA,UAAI,KAAKF,OAAL,CAAaR,MAAjB,EAAyB;AACvB,aAAKuB,eAAL,CAAqB,KAAKf,OAA1B,EAAmC,GAAnC;AACA,aAAKA,OAAL,GAAe,EAAf;AACD;AACD,WAAK9B,mBAAL,GAA2B,KAA3B;;AAEA,WAAK8C,WAAL,GAAmB,IAAnB;;AAEA,WAAKF,WAAL,CACE7B,KAAKuB,SAAL,CAAe;AACbL,cAAM,YADO;AAEbS,gBAAQ,GAFK;AAGbjD,iBAAS,KAAKA,OAHD;AAIb+B,cAAM;AACJuB,eAAK,KAAKrD,qBADN;AAEJsD,kBAAQ;AACNC,wBAAY;AADN;AAFJ;AAJO,OAAf,CADF;AAaD;AACD;;;;;;;AA1LF;AAAA;AAAA,2CAgMyBC,aAhMzB,EAgMwCC,SAhMxC,EAgMmDC,eAhMnD,EAgMoEC,OAhMpE,EAgM6E;AACzE,UAAMpB,OAAO,WAAb;AACA,UAAIqB,iBAAiB,EAArB;;AAEA,UACE,KAAKvE,cAAL,IACAmE,aADA,IAEAA,cAAcjB,IAAd,KAAuB,UAHzB,EAIE;AACAqB,yBAAiBvC,KAAKuB,SAAL,CAAeY,aAAf,CAAjB;AACD;;AAED,UAAM1B,OAAO;AACX2B,mBAAW;AACTI,uBAAaJ,UAAUK,EADd;AAETC,yBAAeL,gBAAgBK,aAFtB;AAGTJ,mBAASA,OAHA;AAITxB,oBAAUsB,UAAUtB,QAJX;AAKTL,gBAAM8B,iBAAiBzE,0BAAjB,GAA8CqE;AAL3C;AADA,OAAb;;AAUA,UAAII,cAAJ,EAAoB;AAClB,aAAK1D,SAAL,CAAe8D,IAAf,CAAoB;AAClBH,uBAAaJ,UAAUK,EADL;AAElBhC,gBAAM8B;AAFY,SAApB;AAID;;AAED,aAAOvC,KAAKuB,SAAL,CAAe;AACpBL,cAAMA,IADc;AAEpBS,gBAAQ,GAFY;AAGpBjD,iBAAS,KAAKA,OAHM;AAIpB+B,cAAMA;AAJc,OAAf,EAKJmB,OALI,OAKQ9D,0BALR,QAKuCyE,cALvC,CAAP;AAMD;AACD;;;;;AApOF;AAAA;AAAA,yCAwOuBK,SAxOvB,EAwOkC;AAC9B,aAAOA,UAAUC,YAAV,CAAuBjB,OAAvB,CAA+B,mBAA/B,EAAoD,EAApD,CAAP;AACD;AACD;;;;;AA3OF;AAAA;AAAA,wCA+OsBgB,SA/OtB,EA+OiCE,QA/OjC,EA+O2CC,QA/O3C,EA+OqD;AACjD,UAAMC,mBAAmB;AACvB7C,cAAM,KAAK8C,oBAAL,CAA0BL,SAA1B,CADiB;AAEvBM,qBAAaN,UAAUM,WAAV,IAAyB,CAFf;AAGvBT,YAAIG,UAAUO,kBAAV,IAAgC,KAAKvE,0BAAL;AAHb,OAAzB;;AAMA,UAAIwE,UAAU7C,MAAV,KAAqB,CAAzB,EAA4B;AAC1ByC,yBAAiBE,WAAjB;AACD;;AAEDN,gBAAUO,kBAAV,GAA+BH,iBAAiBP,EAAhD;AACAG,gBAAUM,WAAV,GAAwBF,iBAAiBE,WAAzC;;AAEA,UAAIH,QAAJ,EAAc;AACZ,aAAK,IAAMM,OAAX,IAAsBN,QAAtB,EAAgC;AAC9B,cAAMO,qBAAqB,KAAK3E,qBAAL,CAA2B0E,OAA3B,CAA3B;;AAEA,eAAK,IAAI/C,IAAI,CAAb,EAAgBA,IAAIgD,mBAAmB/C,MAAvC,EAA+CD,GAA/C,EAAoD;AAClD,gBAAIgD,mBAAmBhD,CAAnB,EAAsBmC,EAAtB,KAA6BG,UAAUO,kBAA3C,EAA+D;AAC7DG,iCAAmBC,MAAnB,CAA0BjD,CAA1B,EAA6B,CAA7B;AACA,kBAAIgD,mBAAmB/C,MAAnB,KAA8B,CAAlC,EAAqC;AACnC,uBAAO,KAAK5B,qBAAL,CAA2B0E,OAA3B,CAAP;AACD;AACD;AACD;AACF;AACF;AACF;;AAED,UAAIP,QAAJ,EAAc;AACZ,aAAK,IAAMO,QAAX,IAAsBP,QAAtB,EAAgC;AAC9B,eAAKnE,qBAAL,CAA2B0E,QAA3B,IAAsC,KAAK1E,qBAAL,CACpC0E,QADoC,IAGlC,KAAK1E,qBAAL,CAA2B0E,QAA3B,EAAoCnE,MAApC,CAA2C8D,gBAA3C,CAHkC,GAIlC,CAACA,gBAAD,CAJJ;AAKD;AACF;AACF;AACD;;;;;;;AAvRF;AAAA;AAAA,sCA6RoBQ,kBA7RpB,EA6RwCC,OA7RxC,EA6RiDC,KA7RjD,EA6RwDC,GA7RxD,EA6R6D;AACzD,UAAI,KAAK5B,WAAT,EAAsB;AACpB,aAAKF,WAAL,CACE7B,KAAKuB,SAAL,CAAe;AACbL,gBAAM,YADO;AAEbS,kBAAQ,GAFK;AAGbjD,mBAAS,KAAKA,OAHD;AAIb+B,gBAAM;AACJuB,iBAAK,KAAKrD,qBADN;AAEJsD,oBAAQ;AACNyB,qBAAOA,KADD;AAENE,wBAAUD,MAAMD,KAFV;AAGND,uBAASA,OAHH;AAINvB,0BAAYsB,mBAAmBxB,GAAnB,CAAuB,KAAKiB,oBAA5B;AAJN;AAFJ;AAJO,SAAf,CADF;AAgBD;AACF;AAhTH;;AAAA;AAAA,EAA8BrF,YAA9B;;AAmTA,eAAe,YAAkB;AAAA,oCAAN+C,IAAM;AAANA,QAAM;AAAA;;AAC/B,4CAAW5C,QAAX,gBAAuB4C,IAAvB;AACD","file":"index.js","sourcesContent":["/* global WebSocket File FileList Blob ImageData VERSION */\nimport { delay } from '../utils'\nimport { DevtoolsBase } from 'function-tree/devtools'\nconst PLACEHOLDER_INITIAL_MODEL = 'PLACEHOLDER_INITIAL_MODEL'\nconst PLACEHOLDER_DEBUGGING_DATA = '$$DEBUGGING_DATA$$'\n\n/*\n  Connects to the Cerebral debugger\n  - Triggers events with information from function tree execution\n  - Stores data related to time travel, if activated\n*/\nexport class Devtools extends DevtoolsBase {\n  constructor({\n    storeMutations = true,\n    preventExternalMutations = true,\n    warnStateProps = true,\n    preventPropsReplacement = false,\n    bigComponentsWarning = 10,\n    host = null,\n    https = false,\n    reconnect = true,\n    reconnectInterval = 5000,\n    allowedTypes = [],\n  } = {}) {\n    super({\n      host,\n      https,\n      reconnect,\n      reconnectInterval,\n    })\n    this.version = VERSION\n    this.debuggerComponentsMap = {}\n    this.debuggerComponentDetailsId = 1\n    this.storeMutations = storeMutations\n    this.preventExternalMutations = preventExternalMutations\n    this.warnStateProps = warnStateProps\n    this.preventPropsReplacement = preventPropsReplacement\n    this.bigComponentsWarning = bigComponentsWarning\n\n    this.mutations = []\n    this.initialModelString = null\n    this.controller = null\n    this.originalRunTreeFunction = null\n    this.isResettingDebugger = false\n    this.allowedTypes = []\n      .concat(typeof File === 'undefined' ? [] : File)\n      .concat(typeof FileList === 'undefined' ? [] : FileList)\n      .concat(typeof Blob === 'undefined' ? [] : Blob)\n      .concat(typeof ImageData === 'undefined' ? [] : ImageData)\n      .concat(typeof RegExp === 'undefined' ? [] : RegExp)\n      .concat(allowedTypes || [])\n\n    this.sendInitial = this.sendInitial.bind(this)\n    this.sendComponentsMap = delay(this.sendComponentsMap, 50)\n  }\n  createSocket() {\n    this.ws = new WebSocket(`${this.https ? 'wss' : 'ws'}://${this.host}`)\n  }\n  /*\n    To remember state Cerebral stores the initial model as stringified\n    object. Since the model is mutable this is necessary. The debugger\n    passes the execution id of the signal that was double clicked. This\n    execution id is searched backwards in the array of mutations done.\n    This is necessary as multiple mutations can be done on the same execution.\n    Then all mutations are replayed to the model and all the components\n    will be rerendered using the \"flush\" event and \"force\" flag.\n\n    It will also replace the \"run\" method of the controller to\n    prevent any new signals firing off when in \"remember state\"\n  */\n  remember(index) {\n    this.controller.model.set([], JSON.parse(this.initialModelString))\n\n    if (index === 0) {\n      this.controller.run = this.originalRunTreeFunction\n    } else {\n      this.controller.run = (name) => {\n        console.warn(\n          `The signal \"${name}\" fired while debugger is remembering state, it was ignored`\n        )\n      }\n    }\n\n    for (let x = 0; x < this.mutations.length - index; x++) {\n      const mutation = JSON.parse(this.mutations[x].data)\n      this.controller.model[mutation.method](...mutation.args)\n    }\n\n    this.controller.flush(true)\n    this.controller.emit(\n      'remember',\n      JSON.parse(this.mutations[index].data).datetime\n    )\n  }\n  /*\n\n  */\n  reset() {\n    this.controller.model.set([], JSON.parse(this.initialModelString))\n    this.backlog = []\n    this.mutations = []\n    this.controller.flush(true)\n  }\n  onMessage(event) {\n    const message = JSON.parse(event.data)\n    switch (message.type) {\n      case 'changeModel':\n        this.controller.model.set(message.data.path, message.data.value)\n        this.controller.flush()\n        break\n      case 'remember':\n        if (!this.storeMutations) {\n          console.warn(\n            'Cerebral Devtools - You tried to time travel, but you have turned of storing of mutations'\n          )\n        } else {\n          this.remember(message.data)\n        }\n        break\n      case 'reset':\n        this.reset()\n        break\n      case 'pong':\n        this.sendInitial()\n        break\n      case 'ping':\n        this.sendInitial()\n        break\n    }\n  }\n  /*\n    The debugger might be ready or it might not. The initial communication\n    with the debugger requires a \"ping\" -> \"pong\" to identify that it\n    is ready to receive messages.\n    1. Debugger is open when app loads\n      - Devtools sends \"ping\"\n      - Debugger sends \"pong\"\n      - Devtools sends \"init\"\n    2. Debugger is opened after app load\n      - Debugger sends \"ping\"\n      - Devtools sends \"init\"\n  */\n  init(controller) {\n    this.controller = controller || this.controller\n    this.originalRunTreeFunction = this.controller.run\n\n    if (this.storeMutations) {\n      this.initialModelString = JSON.stringify(this.controller.model.get())\n    }\n\n    super.init()\n\n    if (controller) {\n      this.watchExecution(this.controller, 'c')\n    }\n  }\n  /*\n    Send initial model. If model has already been stringified we reuse it. Any\n    backlogged executions will also be triggered\n  */\n  sendInitial() {\n    const initialModel = this.controller.model.get()\n    const message = JSON.stringify({\n      type: 'init',\n      source: 'c',\n      version: this.version,\n      data: {\n        initialModel: this.initialModelString\n          ? PLACEHOLDER_INITIAL_MODEL\n          : initialModel,\n      },\n    }).replace(`\"${PLACEHOLDER_INITIAL_MODEL}\"`, this.initialModelString)\n\n    this.isResettingDebugger = true\n    this.sendMessage(message)\n    if (this.backlog.length) {\n      this.sendBulkMessage(this.backlog, 'c')\n      this.backlog = []\n    }\n    this.isResettingDebugger = false\n\n    this.isConnected = true\n\n    this.sendMessage(\n      JSON.stringify({\n        type: 'components',\n        source: 'c',\n        version: this.version,\n        data: {\n          map: this.debuggerComponentsMap,\n          render: {\n            components: [],\n          },\n        },\n      })\n    )\n  }\n  /*\n    Create the stringified message for the debugger. As we need to\n    store mutations with the default true \"storeMutations\" option used\n    by time travel and jumping between Cerebral apps, we are careful\n    not doing unnecessary stringifying.\n  */\n  createExecutionMessage(debuggingData, execution, functionDetails, payload) {\n    const type = 'execution'\n    let mutationString = ''\n\n    if (\n      this.storeMutations &&\n      debuggingData &&\n      debuggingData.type === 'mutation'\n    ) {\n      mutationString = JSON.stringify(debuggingData)\n    }\n\n    const data = {\n      execution: {\n        executionId: execution.id,\n        functionIndex: functionDetails.functionIndex,\n        payload: payload,\n        datetime: execution.datetime,\n        data: mutationString ? PLACEHOLDER_DEBUGGING_DATA : debuggingData,\n      },\n    }\n\n    if (mutationString) {\n      this.mutations.push({\n        executionId: execution.id,\n        data: mutationString,\n      })\n    }\n\n    return JSON.stringify({\n      type: type,\n      source: 'c',\n      version: this.version,\n      data: data,\n    }).replace(`\"${PLACEHOLDER_DEBUGGING_DATA}\"`, mutationString)\n  }\n  /*\n    The container will listen to \"flush\" events from the controller\n    and send an event to debugger about initial registered components\n  */\n  extractComponentName(component) {\n    return component._displayName.replace('CerebralWrapping_', '')\n  }\n  /*\n    Updates the map the represents what active state paths and\n    components are in your app.Called from Controller. Used by the debugger\n  */\n  updateComponentsMap(component, nextDeps, prevDeps) {\n    const componentDetails = {\n      name: this.extractComponentName(component),\n      renderCount: component.renderCount || 0,\n      id: component.componentDetailsId || this.debuggerComponentDetailsId++,\n    }\n\n    if (arguments.length === 1) {\n      componentDetails.renderCount++\n    }\n\n    component.componentDetailsId = componentDetails.id\n    component.renderCount = componentDetails.renderCount\n\n    if (prevDeps) {\n      for (const depsKey in prevDeps) {\n        const debuggerComponents = this.debuggerComponentsMap[depsKey]\n\n        for (let x = 0; x < debuggerComponents.length; x++) {\n          if (debuggerComponents[x].id === component.componentDetailsId) {\n            debuggerComponents.splice(x, 1)\n            if (debuggerComponents.length === 0) {\n              delete this.debuggerComponentsMap[depsKey]\n            }\n            break\n          }\n        }\n      }\n    }\n\n    if (nextDeps) {\n      for (const depsKey in nextDeps) {\n        this.debuggerComponentsMap[depsKey] = this.debuggerComponentsMap[\n          depsKey\n        ]\n          ? this.debuggerComponentsMap[depsKey].concat(componentDetails)\n          : [componentDetails]\n      }\n    }\n  }\n  /*\n    Sends components map to debugger. It is debounced (check constructor).\n    It needs to wait because React updates async. Instead of tracking\n    callbacks we just wait 50ms as it is not that important when\n    debugger updates\n  */\n  sendComponentsMap(componentsToRender, changes, start, end) {\n    if (this.isConnected) {\n      this.sendMessage(\n        JSON.stringify({\n          type: 'components',\n          source: 'c',\n          version: this.version,\n          data: {\n            map: this.debuggerComponentsMap,\n            render: {\n              start: start,\n              duration: end - start,\n              changes: changes,\n              components: componentsToRender.map(this.extractComponentName),\n            },\n          },\n        })\n      )\n    }\n  }\n}\n\nexport default function(...args) {\n  return new Devtools(...args)\n}\n"]}