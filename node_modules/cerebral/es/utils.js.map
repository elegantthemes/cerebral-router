{"version":3,"sources":["../src/utils.js"],"names":["Tag","Compute","getChangedProps","propsA","propsB","propsAKeys","Object","keys","propsBKeys","changedProps","i","length","push","path","cleanPath","replace","isObject","obj","Array","isArray","isComplexObject","isSerializable","value","additionalTypes","validType","reduce","currentValid","type","undefined","prototype","toString","call","constructor","getPrototypeOf","ensurePath","split","throwError","message","Error","isDeveloping","process","env","NODE_ENV","delay","func","wait","args","context","later","apply","setTimeout","forceSerializable","name","defineProperty","e","getProviders","module","assign","providers","modules","nestedProviders","moduleKey","extractAllChildMatches","children","matches","key","concat","dependencyMatch","changes","dependencyMap","currentMatches","changeIndex","currentDependencyMapLevel","pathKeyIndex","dependency","forceChildPathUpdates","getWithPath","currentValue","index","ensureStrictPath","indexOf","createResolver","getters","isTag","arg","types","isType","isCompute","overrideProps","getValue","props","getPath","noop","createDummyController","state","signals","getState","currentState","pathKey","options","on","model","get","getSignal","signal","componentDependencyStore","addEntity","removeEntity","addCerebralStateKey","object","__CerebralState","getStateTreeProp","hit","getModule","pathArray","currentModule","join","splice","extractModuleProp","prop","transform","extracted","additionalExtracted","subModuleKey","extracedWithGetters","currentExtracted","propertyDescriptor","getOwnPropertyDescriptor"],"mappings":"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","file":"utils.js","sourcesContent":["import { Tag } from './tags'\nimport { Compute } from './Compute'\n\nexport function getChangedProps(propsA = {}, propsB = {}) {\n  const propsAKeys = Object.keys(propsA)\n  const propsBKeys = Object.keys(propsB)\n  const changedProps = []\n\n  for (let i = 0; i < propsAKeys.length; i++) {\n    if (propsA[propsAKeys[i]] !== propsB[propsAKeys[i]]) {\n      changedProps.push({ path: [propsAKeys[i]] })\n    }\n  }\n\n  for (let i = 0; i < propsBKeys.length; i++) {\n    if (propsA[propsBKeys[i]] !== propsB[propsBKeys[i]]) {\n      changedProps.push({ path: [propsBKeys[i]] })\n    }\n  }\n\n  return changedProps\n}\n\nexport function cleanPath(path) {\n  return typeof path === 'string' ? path.replace(/\\.\\*\\*|\\.\\*/, '') : path\n}\n\nexport function isObject(obj) {\n  return typeof obj === 'object' && obj !== null && !Array.isArray(obj)\n}\n\nexport function isComplexObject(obj) {\n  return typeof obj === 'object' && obj !== null\n}\n\nexport function isSerializable(value, additionalTypes = []) {\n  const validType = additionalTypes.reduce((currentValid, type) => {\n    if (currentValid || value instanceof type) {\n      return true\n    }\n\n    return currentValid\n  }, false)\n\n  if (\n    value !== undefined &&\n    (validType ||\n      (isObject(value) &&\n        Object.prototype.toString.call(value) === '[object Object]' &&\n        (value.constructor === Object ||\n          Object.getPrototypeOf(value) === null)) ||\n      typeof value === 'number' ||\n      typeof value === 'string' ||\n      typeof value === 'boolean' ||\n      value === null ||\n      Array.isArray(value))\n  ) {\n    return true\n  }\n  return false\n}\n\nexport function ensurePath(path = []) {\n  if (Array.isArray(path)) {\n    return path\n  } else if (typeof path === 'string') {\n    return path.split('.')\n  }\n\n  return []\n}\n\nexport function throwError(message) {\n  throw new Error(`Cerebral - ${message}`)\n}\n\nexport function isDeveloping() {\n  return process.env.NODE_ENV !== 'production'\n}\n\nexport function delay(func, wait) {\n  return function(...args) {\n    const context = this\n    const later = () => {\n      func.apply(context, args)\n    }\n\n    setTimeout(later, wait)\n  }\n}\n\nexport function forceSerializable(value) {\n  if (value && !isSerializable(value)) {\n    const name = value.constructor.name\n\n    try {\n      Object.defineProperty(value, 'toJSON', {\n        value() {\n          return `[${name}]`\n        },\n      })\n    } catch (e) {}\n  }\n\n  return value\n}\n\nexport function getProviders(module) {\n  return Object.assign(\n    module.providers || {},\n    Object.keys(module.modules || {}).reduce((nestedProviders, moduleKey) => {\n      return Object.assign(\n        nestedProviders,\n        getProviders(module.modules[moduleKey])\n      )\n    }, {})\n  )\n}\n\nfunction extractAllChildMatches(children) {\n  return Object.keys(children).reduce((matches, key) => {\n    if (children[key].children) {\n      return matches\n        .concat(children[key])\n        .concat(extractAllChildMatches(children[key].children))\n    }\n\n    return matches.concat(children[key])\n  }, [])\n}\n\nexport function dependencyMatch(changes, dependencyMap) {\n  let currentMatches = []\n\n  for (let changeIndex = 0; changeIndex < changes.length; changeIndex++) {\n    let currentDependencyMapLevel = dependencyMap\n    for (\n      let pathKeyIndex = 0;\n      pathKeyIndex < changes[changeIndex].path.length;\n      pathKeyIndex++\n    ) {\n      if (!currentDependencyMapLevel) {\n        break\n      }\n\n      if (currentDependencyMapLevel['**']) {\n        currentMatches.push(currentDependencyMapLevel['**'])\n      }\n\n      if (pathKeyIndex === changes[changeIndex].path.length - 1) {\n        const dependency =\n          currentDependencyMapLevel[changes[changeIndex].path[pathKeyIndex]]\n        if (dependency) {\n          currentMatches.push(dependency)\n\n          if (dependency.children) {\n            if (changes[changeIndex].forceChildPathUpdates) {\n              currentMatches = currentMatches.concat(\n                extractAllChildMatches(dependency.children)\n              )\n            } else {\n              if (dependency.children['**']) {\n                currentMatches.push(dependency.children['**'])\n              }\n\n              if (dependency.children['*']) {\n                currentMatches.push(dependency.children['*'])\n              }\n            }\n          }\n        }\n\n        if (currentDependencyMapLevel['*']) {\n          currentMatches.push(currentDependencyMapLevel['*'])\n        }\n      }\n\n      if (!currentDependencyMapLevel[changes[changeIndex].path[pathKeyIndex]]) {\n        currentDependencyMapLevel = null\n        break\n      }\n\n      currentDependencyMapLevel =\n        currentDependencyMapLevel[changes[changeIndex].path[pathKeyIndex]]\n          .children\n    }\n  }\n\n  return currentMatches\n}\n\nexport function getWithPath(obj) {\n  return (path) => {\n    return path.split('.').reduce((currentValue, key, index) => {\n      if (index > 0 && currentValue === undefined) {\n        throwError(\n          `You are extracting with path \"${path}\", but it is not valid for this object`\n        )\n      }\n\n      return currentValue[key]\n    }, obj)\n  }\n}\n\nexport function ensureStrictPath(path, value) {\n  if (isComplexObject(value) && path.indexOf('*') === -1) {\n    return `${path}.**`\n  }\n\n  return path\n}\n\nexport function createResolver(getters) {\n  return {\n    isTag(arg, ...types) {\n      if (!(arg instanceof Tag)) {\n        return false\n      }\n\n      if (types.length) {\n        return types.reduce((isType, type) => {\n          return isType || type === arg.type\n        }, false)\n      }\n\n      return true\n    },\n    isCompute(arg) {\n      return arg instanceof Compute\n    },\n    value(arg, overrideProps) {\n      if (arg instanceof Tag || arg instanceof Compute) {\n        return arg.getValue(\n          overrideProps\n            ? Object.assign({}, getters, { props: overrideProps })\n            : getters\n        )\n      }\n\n      return arg\n    },\n    path(arg) {\n      if (arg instanceof Tag) {\n        return arg.getPath(getters)\n      }\n\n      throwError('You are extracting a path from an argument that is not a Tag')\n    },\n  }\n}\n\nexport const noop = () => {}\n\n/*\n  When testing and running on the server there is no need to\n  initialize all of Cerebral. So by not passing a controller\n  to this Container it will create a dummy version which inserts\n  state and mocks any signals when connecting the component.\n*/\nexport function createDummyController(state = {}, signals = {}) {\n  const getState = (path) => {\n    return ensurePath(path).reduce((currentState, pathKey) => {\n      return currentState ? currentState[pathKey] : undefined\n    }, state)\n  }\n  return {\n    options: {},\n    on() {},\n    getState,\n    model: {\n      get: getState,\n    },\n    getSignal(signal) {\n      return signals[signal] || (() => {})\n    },\n    componentDependencyStore: {\n      addEntity: noop,\n      removeEntity: noop,\n    },\n  }\n}\n\nexport function addCerebralStateKey(object) {\n  if (isComplexObject(object)) {\n    for (const key in object) {\n      addCerebralStateKey(object[key])\n    }\n\n    !object.__CerebralState &&\n      Object.defineProperty(object, '__CerebralState', {\n        value: true,\n      })\n  }\n\n  return object\n}\n\nexport function getStateTreeProp(props = {}) {\n  return Object.keys(props).reduce((hit, key) => {\n    if (\n      !hit &&\n      isComplexObject(props[key]) &&\n      '__CerebralState' in props[key]\n    ) {\n      return key\n    }\n\n    return hit\n  }, null)\n}\n\nexport function getModule(path, modules) {\n  const pathArray = Array.isArray(path) ? path : ensurePath(path)\n  return pathArray.reduce((currentModule, key) => {\n    if (!currentModule.modules[key]) {\n      throwError(\n        `The path \"${pathArray.join(\n          '.'\n        )}\" is invalid, can not find module. Does the path \"${pathArray\n          .splice(0, path.length - 1)\n          .join('.')}\" exist?`\n      )\n    }\n    return currentModule.modules[key]\n  }, modules)\n}\n\nexport function extractModuleProp(module, prop, transform) {\n  const extracted = Object.keys(module.modules || {}).reduce(\n    (additionalExtracted, subModuleKey) => {\n      additionalExtracted[subModuleKey] = extractModuleProp(\n        module.modules[subModuleKey],\n        prop,\n        transform\n      )\n\n      return additionalExtracted\n    },\n    {}\n  )\n\n  if (module[prop]) {\n    const extracedWithGetters = Object.keys(module[prop]).reduce(\n      (currentExtracted, key) => {\n        const propertyDescriptor = Object.getOwnPropertyDescriptor(\n          module[prop],\n          key\n        )\n        if (propertyDescriptor && 'get' in propertyDescriptor) {\n          Object.defineProperty(currentExtracted, key, propertyDescriptor)\n        } else {\n          currentExtracted[key] = module[prop][key]\n        }\n\n        return currentExtracted\n      },\n      extracted\n    )\n\n    return transform\n      ? transform(extracedWithGetters, module)\n      : extracedWithGetters\n  }\n\n  return extracted\n}\n"]}